<div class="card" style="background-color: #34495E; color: rgb(212, 212, 212);">
    <div class="card-content">
        <app-title title="Estadísticas"/>
    </div>
</div>
<hr>

@for (reporte of reportesAgrupados; track $index; let i = $index) {
    <div class="card">
        <header class="card-header">
            <p class="card-header-title">
                @if (reporte.puntosAcumulados >= 15) {
                    <i class="far fa-thumbs-up" style="color: rgb(93, 194, 93);"></i> 
                } @else {
                    <i class="far fa-thumbs-down" style="color: rgb(218, 116, 116);"></i> 
                }
                {{reporte.promotora}} ({{reporte.puntosAcumulados}} Puntos)
            </p>
            <button class="card-header-icon" aria-label="more options" (click)="togglePromotoraSection(i)">
                <span class="icon" [ngClass]="{'rotado': isRotated[i]}">
                  <i class="fas fa-angle-down" aria-hidden="true"></i>
                </span>
            </button>
        </header>
        <div class="card-content" [ngClass]="{'oculto':!togglePromotora[i], 'activo':togglePromotora[i]}">
            <span><b>Total vendido:</b>{{reporte.totalGastado}}$</span>
            <br> <br>
            @for (ventas of reporte.reportes; track $index; let j = $index) {
            <div class="card">
                    <header class="card-header">
                        <p class="card-header-title">
                            {{ventas.fecha | date: 'dd/MM/yyyy'}} - {{ventas.totalSubtotal}}$ ({{ventas.totalPuntos}} Puntos)
                        </p>
                        <button class="card-header-icon" aria-label="more options" (click)="toggleVentaSection(i, j)">
                            <span class="icon">
                              <i class="fas fa-angle-down" aria-hidden="true"></i>
                            </span>
                        </button>
                    </header>
                    <!-- @ts-ignore -->
                    <div class="card-content" [ngClass]="{'oculto': !toggleVentas[i] || !toggleVentas[i][j], 'activo': toggleVentas[i] && toggleVentas[i][j]}">
                        <b>Establecimiento:</b> {{ventas.cliente}} <br>
                        <b>Tipo:</b> {{ventas.tipo}} <br>
                        <b>Observación:</b> {{ventas.observacion}}
                        <hr>
                        <table class="table is-fullwidth is-striped" [ngClass]="{'oculto': !toggleVentas[i] || !toggleVentas[i][j], 'activo': toggleVentas[i] && toggleVentas[i][j]}">
                            <thead>
                                <tr>
                                    <th>Linea</th>
                                    <th>Marca</th>
                                    <th>Producto</th>
                                    <th>Cantidad (Und)</th>
                                    <th>Puntos</th>
                                    <th>Subtotal (USD)</th>
                                </tr>
                            </thead>
                            <tbody>
                                @for(productos of ventas.productos; track $index){
                                    <tr>
                                        <td>{{productos.linea}}</td>
                                        <td>{{productos.marca}}</td>
                                        <td>{{productos.producto}}</td>
                                        <td>{{productos.cantidad}}</td>
                                        <td>{{productos.puntosTotales}}</td>
                                        <td>{{productos.subtotal}} $</td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            }
        </div>
    </div>
}